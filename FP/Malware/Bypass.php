<?php 

$SFileName = $_SERVER['PHP_SELF'];
error_reporting(E_ALL);
$PHPVer = phpversion();
$scriptTitle = "Script";

function sanitize_input($data) {
    return htmlspecialchars(stripslashes(trim($data)));
}

function walkArray(&$array) {
    foreach ($array as $key => $data) {
        if (is_array($data)) {
            walkArray($data);
        } else {
            global $$key;
            $$key = sanitize_input($data);
        }
    }
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    walkArray($_POST);
} elseif ($_SERVER['REQUEST_METHOD'] === 'GET') {
    walkArray($_GET);
}

function safe_filemanager() {
    $cwd = getcwd();
    echo "<table border='1' cellpadding='3'><tr><th>Filename</th><th>Size</th></tr>";
    $files = scandir($cwd);
    foreach ($files as $file) {
        if ($file !== "." && $file !== "..") {
            echo "<tr><td>" . htmlspecialchars($file) . "</td><td>" . filesize($file) . " bytes</td></tr>";
        }
    }
    echo "</table>";
}

function system_info() {
    echo "<table border='1' cellpadding='5'>";
    echo "<tr><td>Server:</td><td>" . $_SERVER['SERVER_NAME'] . "</td></tr>";
    echo "<tr><td>PHP Version:</td><td>" . phpversion() . "</td></tr>";
    echo "<tr><td>Document Root:</td><td>" . $_SERVER['DOCUMENT_ROOT'] . "</td></tr>";
    echo "</table>";
}

?>

<!DOCTYPE html>
<html>
<head>
    <title><?php echo $scriptTitle; ?></title>
</head>
<body>
    <h2><?php echo $scriptTitle; ?> - File Manager</h2>
    <?php safe_filemanager(); ?>

    <h2>System Information</h2>
    <?php system_info(); ?>
</body>
</html>
