<?php
define('VERSION', '1.0');

function sanitize_path($path) {
    return preg_replace('/[^a-zA-Z0-9_\-\/\.]/', '', $path); // âœ… Only allow safe characters
}

$dir = isset($_REQUEST['dir']) ? sanitize_path($_REQUEST['dir']) : ".";

if (!is_dir($dir)) {
    echo "<p style='color: red;'>Invalid directory.</p>";
    exit();
}

$rep = opendir($dir);
?>
<html>
<head>
    <title>Secure code</title>
</head>
<body>
    <h1>File Browser v<?php echo VERSION; ?></h1>
    <hr>

    <p>Current Directory: <b><?php echo htmlspecialchars($dir); ?></b></p>

    <table border="1" width="100%">
        <tr>
            <th>Directories</th>
            <th>Files</th>
        </tr>
        <?php
        while ($entry = readdir($rep)) {
            if ($entry == '.' || $entry == '..') continue;
            if (is_dir("$dir/$entry")) {
                echo "<tr><td><a href='?dir=".htmlspecialchars("$dir/$entry")."'>$entry/</a></td><td></td></tr>";
            } else {
                echo "<tr><td></td><td>".htmlspecialchars($entry)."</td></tr>";
            }
        }
        closedir($rep);
        ?>
    </table>

    <p><a href="<?php echo $_SERVER['PHP_SELF']; ?>?dir=">Go to Home Directory</a></p>

</body>
</html>
